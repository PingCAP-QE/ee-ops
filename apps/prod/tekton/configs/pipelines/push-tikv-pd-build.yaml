apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: push-tikv-pd-build
spec:
  params:
    - name: git-url
      type: string
    - name: git-ref
      type: string
    - name: git-revision
      default: main
      type: string
  workspaces:
    - name: source
      description: The workspace where the git repo will be cloned.
  tasks:
    - name: checkout
      taskRef:
        kind: Task
        name: git-clone
      params:
        - name: url
          value: $(params.git-url)
        - name: revision
          value: $(params.git-revision)
      workspaces:
        - name: output
          workspace: source
    - name: generate-building-scripts-for-tarballs
      taskRef:
        name: generate-building-scripts-for-tarballs
      runAfter:
        - checkout
      matrix:
        params:
          - name: os
            value: [linux, darwin]
          - name: arch
            value:  [amd64, arm64]
          - name: profile
            value: [release, debug]
      params:
        - name: component
          value: $(params.repo)
        - name: version
          value: "v7.5.0"
        - name: git-ref
          value: $(params.git-ref)
        - name: git-sha
          value: $(params.git-revision)
    - name: generate-building-scripts-for-images
      taskRef:
        name: generate-building-scripts-for-images
      runAfter:
        - checkout
      matrix:
        params:
          - name: os
            value: [linux, darwin]
          - name: arch
            value:  [amd64, arm64]
          - name: profile
            value: [release, debug]
      params:
        - name: component
          value: $(params.repo)
        - name: version
          value: "v7.5.0"
        - name: git-ref
          value: $(params.git-ref)
        - name: git-sha
          value: $(params.git-revision)
    # - name: builds
