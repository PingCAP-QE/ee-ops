apiVersion: triggers.tekton.dev/v1beta1
kind: Trigger
metadata:
  name: image-push-gcr-tiflow-operator
  labels:
    type: image-push
  namespace: ee-cd
spec:
  interceptors:
  - name: filter on image repo names
    ref:
      kind: ClusterInterceptor
      name: cel
    params:
    - name: filter
      value: body.event_data.repository.repo_full_name in ['pingcap/tiflow-operator/image']
  - name: filter on image tags
    ref:
      kind: ClusterInterceptor
      name: cel
    params:
    - name: filter
      value: body.event_data.resources[0].tag.matches('^master$')
  bindings:
  - kind: TriggerBinding
    ref: harbor-image-push
  - name: target_img
    value: "gcr.io/pingcap-public/tidbcloud/tiflow-operator"
  template:
    ref: image-sync-to-gcr-latest
