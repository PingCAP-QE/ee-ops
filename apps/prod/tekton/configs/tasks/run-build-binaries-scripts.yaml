apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: run-building-scripts-for-tarballs
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/platforms: "linux/amd64,linux/arm64"
spec:
  workspaces:
    - name: source
    - name: build-scripts
  params:
    - name: release-dir
      default: build
    - name: build-image
      default: ghcr.io/pingcap-qe/ci/release-utils:v20231107-4086b32
    - name: run-script-file
      default: build-package-artifacts.sh
    - name: need-build
      default: 'true'
  steps:
    - name: build
      image: "$(params.build-image)"
      workingDir: $(workspaces.source.path)
      script: |
        $(workspaces.build-scripts.path)/$(params.run-script-file) "$(params.release-dir)" "$(params.need-build)"
