apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: run-building-scripts-for-images
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/platforms: "linux/amd64,linux/arm64"
spec:
  workspaces:
    - name: source
    - name: build-scripts
    - name: dockerconfig
      description: Includes a docker `config.json`
      mountPath: /kaniko/.docker      
      optional: true
  results:
    - description: Digest of the image just built.
      name: IMAGE_DIGEST
    - description: URL of the image just built.
      name: IMAGE_URL
  params:
    - name: release-dir
      default: build
    - name: build-image
      default: gcr.io/kaniko-project/executor:debug
    - name: kaniko-executor
      default: /kaniko/executor
    - name: run-script-file
      default: build-package-images.sh
    - name: need-build
      default: 'false'
  steps:
    - name: build
      image: "$(params.build-image)"
      workingDir: $(workspaces.source.path)
      script: |
        $(workspaces.build-scripts.path)/$(params.run-script-file) "$(params.release-dir)" "$(params.tag)" "$(params.kaniko-executor)" "$(params.need-build)"
