apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: apps-sec
resources:
  - deployment.yaml
  - service.yaml
patches:
    - patch: |
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: sec-server
        spec:
          template:
            spec:
              imagePullSecrets:
                - name: sec-registry-cred
              volumes:
                - name: redis-cred
                  secret:
                    secretName: redis
                - name: db-cred
                  secret:
                    secretName: db
                - name: bucket-cred
                  secret:
                    secretName: bucket
                - name: system-cred
                  secret:
                    secretName: system
                   
      target:
        kind: Deployment
        name: sec-server