apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: prow-github
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: ee-gcp-sm
    kind: ClusterSecretStore
  target:
    name: prow-github
    creationPolicy: Owner
  dataFrom:
    - extract:
        # json object contains keys: `app-id`, `app-private-key`, `secret`
        #
        #   The `secret` is OAuth config blob required by Prow, example content:
        #     client_id: "..."
        #     client_secret: "..."
        #     redirect_url: "https://<your-domain>/github-login/redirect"
        #     final_redirect_url: "https://<your-domain>/pr"
        key: gcp_prow_github_app_json
  data:
    - secretKey: token # PAT or bot token used where needed
      remoteRef:
        key: gcp_prow_github_pat
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: prow-webhook
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: ee-gcp-sm
    kind: ClusterSecretStore
  target:
    name: prow-webhook
    creationPolicy: Owner
  data:
    - secretKey: hmac
      remoteRef:
        key: gcp_prow_github_app_webhook_hmac
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: prow-oauth-cookie
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: ee-gcp-sm
    kind: ClusterSecretStore
  target:
    name: prow-oauth-cookie
    creationPolicy: Owner
  data:
    - secretKey: secret
      remoteRef:
        key: gcp_prow_github_app_oauth_cookie_secret
